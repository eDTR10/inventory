import{c as $,r as u,j as e,X as Z,B as c,_ as ee,i as te,u as ae}from"./index-ba517387.js";import{u as se,I as A}from"./input-53fec541.js";const H=$("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]),ne=$("ExternalLink",[["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}],["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["line",{x1:"10",x2:"21",y1:"14",y2:"3",key:"18c3s4"}]]),le=$("QrCode",[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]]),re=a=>`https://edtr10.github.io/inventory/item/${encodeURIComponent(a)}`,G=(a,n=200)=>{const l=re(a),h=encodeURIComponent(l);return`https://api.qrserver.com/v1/create-qr-code/?size=${n}x${n}&data=${h}&margin=15`},ie=({itemName:a,onClose:n})=>{const[l,h]=u.useState(300),x=G(a,l),p=`https://edtr10.github.io//inventory/item/${encodeURIComponent(a)}`,S=async()=>{try{const Q=await(await fetch(x)).blob(),r=new Image;r.onload=()=>{const d=document.createElement("canvas"),i=30,w=60,j=r.width+i*2,v=r.height+i*2+w,o=d.getContext("2d");o&&(d.width=j,d.height=v,o.fillStyle="white",o.fillRect(0,0,j,v),o.drawImage(r,i,i),o.fillStyle="#1f2937",o.font="bold 20px Arial, sans-serif",o.textAlign="center",o.fillText(`${a}`,j/2,r.height+i+45),d.toBlob(k=>{if(k){const y=window.URL.createObjectURL(k),g=document.createElement("a");g.href=y,g.download=`${a}-qrcode.png`,document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(y),document.body.removeChild(g)}}))},r.src=URL.createObjectURL(Q)}catch(b){console.error("Failed to download QR code:",b)}},D=()=>{window.open(p,"_blank")};return e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white dark:bg-slate-900 rounded-lg shadow-xl p-6 max-w-md w-full mx-4",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-xl font-bold",children:"QR Code Link"}),n&&e.jsx("button",{onClick:n,className:"p-1 hover:bg-gray-100 dark:hover:bg-slate-800 rounded",children:e.jsx(Z,{className:"w-5 h-5"})})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mb-4",children:["Item: ",e.jsx("span",{className:"font-semibold text-gray-900 dark:text-white",children:a})]}),e.jsx("div",{className:"bg-white p-4 rounded border border-gray-200 flex items-center justify-center mb-4",children:e.jsx("img",{src:x,alt:`QR Code for ${a}`,className:"w-full"})}),e.jsxs("div",{className:"mb-4",children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Size (px)"}),e.jsx("input",{type:"range",min:"150",max:"500",step:"50",value:l,onChange:b=>h(parseInt(b.target.value)),className:"w-full"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:[l,"x",l,"px"]})]}),e.jsxs("div",{className:"mb-4 p-3 bg-blue-50 dark:bg-slate-800 rounded border border-blue-200 dark:border-blue-700",children:[e.jsx("p",{className:"text-xs font-medium text-gray-900 dark:text-white mb-2",children:"Link:"}),e.jsx("p",{className:"text-xs text-gray-700 dark:text-gray-300 break-all font-mono",children:p})]}),e.jsx("p",{className:"text-xs text-gray-600 dark:text-gray-400 bg-gray-50 dark:bg-slate-800 p-3 rounded mb-4",children:"ðŸ“± Scan this QR code to open the item page where users can add or deduct quantities from their mobile device!"})]}),e.jsxs("div",{className:"flex gap-2 flex-col",children:[e.jsxs(c,{onClick:S,className:"w-full",variant:"default",children:[e.jsx(H,{className:"w-4 h-4 mr-2"}),"Download QR Code"]}),e.jsxs(c,{onClick:D,variant:"outline",className:"w-full",children:[e.jsx(ne,{className:"w-4 h-4 mr-2"}),"Open Item Link"]}),n&&e.jsx(c,{onClick:n,variant:"outline",className:"w-full",children:"Close"})]})]})})},oe=()=>{const{items:a,loading:n,error:l,fetchItems:h,addItem:x,updateItem:p,deleteItem:S,addQuantity:D,removeQuantity:b,initSheet:Q}=se(),[r,d]=u.useState({itemName:"",image:"",quantity:0}),[i,w]=u.useState(null),[j,v]=u.useState(null),[o,k]=u.useState(!1);u.useEffect(()=>{(async()=>{try{await Q(),await h()}catch(s){console.error("Failed to initialize:",s)}})()},[]);const y=t=>{const{name:s,value:f}=t.target;d(F=>({...F,[s]:s==="quantity"?parseInt(f)||0:f}))},g=async t=>{if(t.preventDefault(),!r.itemName.trim()){alert("Please enter an item name");return}try{i?(await p(i,r),w(null)):await x(r),d({itemName:"",image:"",quantity:0})}catch(s){console.error("Failed to save item:",s)}},O=t=>{d({itemName:t.itemName,image:t.image||"",quantity:t.quantity}),w(t.itemName)},W=async t=>{if(window.confirm(`Delete "${t}"?`))try{await S(t)}catch(s){console.error("Failed to delete item:",s)}},M=async(t,s)=>{try{s==="add"?await D(t,1):await b(t,1)}catch(f){console.error("Failed to change quantity:",f)}},B=async()=>{if(a.length===0){alert("No items to download");return}if(!o){k(!0);try{const t=(await ee(()=>import("./jspdf.es.min-430ce9fa.js").then(N=>N.j),["assets/jspdf.es.min-430ce9fa.js","assets/index-ba517387.js","assets/index-ed1a0b93.css"])).jsPDF,s=new t({orientation:"portrait",unit:"mm",format:"a4"}),f=s.internal.pageSize.getWidth(),F=s.internal.pageSize.getHeight(),m=10,q=50,T=70,L=3,z=(f-m*2)/L;let V=1,C=0;s.setFontSize(16),s.text("Inventory QR Codes",m,m),s.setFontSize(10),s.text(`Generated: ${new Date().toLocaleDateString()}`,m,m+7);let I=m+15;const Y=F-m;for(let N=0;N<a.length;N++){const R=a[N],X=N%L,_=m+X*z;try{const U=G(R.itemName,200),J=await(await fetch(U)).blob(),E=new FileReader;await new Promise(K=>{E.onload=()=>{try{const P=E.result;s.addImage(P,"PNG",_+5,I,q,q),s.setFontSize(8),s.text(R.itemName,_+z/2,I+q+8,{align:"center",maxWidth:z-10}),C++,(C%L===0||C===a.length)&&(I+=T,I>Y&&C<a.length&&(s.addPage(),V++,I=m))}catch(P){console.error(`Failed to add QR code for ${R.itemName}:`,P)}K()},E.readAsDataURL(J)})}catch(U){console.error(`Failed to load QR code for ${R.itemName}:`,U)}}s.save(`inventory-qr-codes-${new Date().toISOString().split("T")[0]}.pdf`)}catch(t){console.error("Failed to download QR codes:",t),alert("Failed to download QR codes as PDF")}finally{k(!1)}}};return e.jsxs("div",{className:"p-8 max-w-6xl mx-auto",children:[e.jsx("h1",{className:"text-3xl font-bold mb-8",children:"Inventory Management"}),l&&e.jsxs("div",{className:"mb-4 p-4 bg-red-100 text-red-700 rounded",children:["Error: ",l]}),e.jsxs("form",{onSubmit:g,className:"mb-8 p-6 bg-gray-50 rounded-lg border",children:[e.jsx("h2",{className:"text-xl font-semibold mb-4",children:i?"Edit Item":"Add New Item"}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Item Name *"}),e.jsx(A,{type:"text",name:"itemName",value:r.itemName,onChange:y,placeholder:"e.g., Sack Bag",disabled:!!i})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Image URL"}),e.jsx(A,{type:"text",name:"image",value:r.image,onChange:y,placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium mb-2",children:"Quantity"}),e.jsx(A,{type:"number",name:"quantity",value:r.quantity,onChange:y,placeholder:"0"})]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(c,{type:"submit",children:i?"Update Item":"Add Item"}),i&&e.jsx(c,{type:"button",variant:"outline",onClick:()=>{w(null),d({itemName:"",image:"",quantity:0})},children:"Cancel"})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h2",{className:"text-xl font-semibold",children:["Inventory Items (",a.length,")"]}),a.length>0&&e.jsx(c,{onClick:B,disabled:o,className:"gap-2 bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed",children:o?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"inline-block animate-spin",children:"â³"}),"Generating PDF..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"w-4 h-4"}),"Download All QR Codes (PDF)"]})})]}),n?e.jsx("p",{className:"text-gray-600",children:"Loading items..."}):a.length===0?e.jsx("p",{className:"text-gray-600",children:"No items in inventory"}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-gray-200",children:[e.jsx("th",{className:"border p-3 text-left",children:"Item Name"}),e.jsx("th",{className:"border p-3 text-left",children:"Image"}),e.jsx("th",{className:"border p-3 text-right",children:"Quantity"}),e.jsx("th",{className:"border p-3 text-center",children:"QR Code"}),e.jsx("th",{className:"border p-3 text-center",children:"Actions"})]})}),e.jsx("tbody",{children:a.map(t=>e.jsxs("tr",{className:"border hover:bg-gray-50",children:[e.jsx("td",{className:"border p-3 font-medium",children:t.itemName}),e.jsx("td",{className:"border p-3",children:t.image?e.jsx("a",{href:t.image,target:"_blank",rel:"noreferrer",className:"text-blue-600 hover:underline",children:"View Image"}):e.jsx("span",{className:"text-gray-400",children:"-"})}),e.jsx("td",{className:"border p-3 text-right",children:e.jsxs("div",{className:"flex items-center justify-end gap-2",children:[e.jsx("button",{onClick:()=>M(t.itemName,"remove"),className:"px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200",children:"-"}),e.jsx("span",{className:"w-8 text-center font-semibold",children:t.quantity}),e.jsx("button",{onClick:()=>M(t.itemName,"add"),className:"px-2 py-1 bg-green-100 text-green-700 rounded hover:bg-green-200",children:"+"})]})}),e.jsx("td",{className:"border p-3 text-center",children:e.jsxs(c,{size:"sm",variant:"outline",onClick:()=>v(t.itemName),className:"gap-2",children:[e.jsx(le,{className:"w-4 h-4"}),"Show QR"]})}),e.jsx("td",{className:"border p-3 text-center",children:e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsx(c,{size:"sm",variant:"outline",onClick:()=>O(t),children:"Edit"}),e.jsx(c,{size:"sm",variant:"outline",onClick:()=>W(t.itemName),className:"text-red-600 hover:text-red-700",children:"Delete"})]})})]},t.id))})]})})]}),j&&e.jsx(ie,{itemName:j,onClose:()=>v(null)})]})},ce=({children:a,onLogin:n})=>te()?e.jsx(e.Fragment,{children:a}):e.jsx("div",{className:"min-h-screen w-full flex items-center justify-center bg-gradient-to-br from-background to-background/80",children:e.jsxs("div",{className:"text-center space-y-6 p-8 max-w-md",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Access Required"}),e.jsx("p",{className:"text-lg text-muted-foreground",children:"You need to authenticate with Google to access the inventory system."})]}),e.jsxs("div",{className:"bg-muted p-6 rounded-lg space-y-3 text-sm",children:[e.jsx("p",{className:"text-left",children:e.jsx("span",{className:"font-semibold",children:"Benefits:"})}),e.jsxs("ul",{className:"text-left space-y-2",children:[e.jsx("li",{children:"âœ“ Secure access to your inventory data"}),e.jsx("li",{children:"âœ“ Real-time synchronization with Google Sheets"}),e.jsx("li",{children:"âœ“ Full CRUD operations"}),e.jsx("li",{children:"âœ“ Automatic data backup"})]})]}),e.jsx(c,{onClick:n,size:"lg",className:"w-full",children:"Sign In with Google"}),e.jsx("div",{className:"bg-blue-50 dark:bg-blue-950 p-4 rounded text-xs text-left",children:e.jsxs("p",{className:"text-blue-900 dark:text-blue-100",children:[e.jsx("span",{className:"font-semibold",children:"ðŸ’¡ Tip:"})," Check your browser console (F12) for detailed login information."]})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Your data is secure and we only access what you allow."})]})}),xe=()=>{const{login:a}=ae(),[n,l]=u.useState(null),h=async()=>{l(null);try{await a()}catch(x){const p=x instanceof Error?x.message:"Failed to login";l(p)}};return e.jsxs("div",{className:" min-h-full w-full max-w-[1468px]  flex flex-col justify-center",children:[e.jsx(ce,{onLogin:h,children:e.jsx(oe,{})}),n&&e.jsx("div",{className:"mt-4 p-4 bg-red-100 text-red-700 rounded",children:e.jsxs("p",{children:["Error: ",n]})})]})};export{xe as default};
